
## PEDSnet CDM V2

The PEDSnet common data model version2 is based on the OMOP CDM V5. A full description of the data model and the ETL Conventions is available in the [PEDSnet CDM V2 ETL Conventions](V2/docs/Pedsnet_CDM_V2_OMOPV5_ETL_Conventions.md) file. The PEDSnet CDM V2 documentation covers the tables from OMOP which have been part of PEDSnet operation up to this point, but the data definition language files include all of the OMOP tables. Those tables not documented are still in a draft state.

### ETL Conventions for version 2

The PEDSnet ETL conventions are described in the [PEDSnet CDM V2 ETL Conventions](V2/docs/Pedsnet_CDM_V2_OMOPV5_ETL_Conventions.md) file and should be followed as much as possible when extracting data from source systems into the PEDSnet CDM, in order to improve data quality and consistency across the network. These conventions were developed collaboratively and represent the best solutions for existing use cases across PEDSnet, but are still works-in-progress. Please submit any comments [here](https://github.com/PEDSnet/Data_Models/issues). Please also consider contributing! Find advice and instructions for contributing (or maintaining a separate version with your own annotations) [here](CONTRIBUTING.md).

### Database Dialects for Version 2

DDL scripts for creating the PEDSnet CDM V2 will be available soon!

- PostgreSQL *link coming soon*
- MySQL *link coming soon*
- Oracle *link coming soon*
- MS SQL Server *link coming soon*

## Original OMOP files

The original OMOP CDM and Vocabulary V5 specification is included in [docs](V2/docs) directory for reference.


***
***



## PEDSnet CDM V1

The PEDSnet common data model is based on the OMOP CDM V4. A full description of the data model is available in the [PEDSnet CDM V1](V1/docs/PEDSnet_CDM_V1.md) file. A description of PEDSnet ETL conventions for the CDM is available in the [PEDSnet CDM V1 ETL Conventions](V1/docs/PEDSnet_CDM_V1_ETL_Conventions.md) file. The most recent versions of these files are also available in MS Word (.docx) format and a Word "DocDiff" is included to highlight the most recent changes (all in the [docs](V1/docs) directory). The PEDSnet CDM V1 documentation covers the tables from OMOP which have been part of PEDSnet operation up to this point, but the data definition language files here include all of the OMOP tables. Those tables not documented are still in a draft state.

### ETL Conventions

The PEDSnet ETL conventions are described in the [PEDSnet CDM V1 ETL Conventions](V1/docs/PEDSnet_CDM_V1_ETL_Conventions.md) file and should be followed as much as possible when extracting data from source systems into the PEDSnet CDM, in order to improve data quality and consistency across the network. These conventions were developed collaboratively and represent the best solutions for existing use cases across PEDSnet, but are still works-in-progress. Please submit any comments [here](https://github.com/PEDSnet/Data_Models/issues). Please also consider contributing! Find advice and instructions for contributing (or maintaining a separate version with your own annotations) [here](CONTRIBUTING.md).

### Database Dialects

DDL scripts for creating the PEDSnet CDM V1 (and the rest of the OMOP tables, which are in draft state), are available for:

- PostgreSQL at [PEDSnet_CDM_V1_pgsql.ddl](V1/PEDSnet_CDM_V1_pgsql.ddl)
- MySQL at [PEDSnet_CDM_V1_mysql.ddl](V1/PEDSnet_CDM_V1_mysql.ddl)
- Oracle at [PEDSnet_CDM_V1_oracle.ddl](V1/PEDSnet_CDM_V1_oracle.ddl)
- MS SQL Server at [PEDSnet_CDM_V1_mssql.ddl](V1/PEDSnet_CDM_V1_mssql.ddl)

These scripts were generated by creating a declarative representation of the CDM using [SQLAlchemy](http://www.sqlalchemy.org/) syntax and programmatically converting it into dialect-specific DDL. For this reason, the scripts are not yet fully tested. Please report any issues [here](https://github.com/PEDSnet/pedsnetcdms/issues).

DDL for the PEDSnet CDM V1 table and column comments (based on the OMOP CDM V4 comments) are available at [PEDSnet_CDM_V1_comments.ddl](V1/PEDSnet_CDM_V1_comments.ddl). The syntax should work on PostgreSQL and Oracle, but not on MySQL or MS SQL Server.

Since these files were created, the DDL generation code has moved to the [PEDSnet/pedsnetcdms](https://github.com/PEDSnet/pedsnetcdms) repository. Please look there for further work on that process.

### Changes from OMOP CDM V4

#### Field additions and deletions

1. Add `pn_time_of_birth` and `pn_gestational_age` fields to the `person` table.
2. Add `provider_id` field to the `visit_occurrence` table.
3. Change field orders within some tables.

#### Null constraint changes

1. Make `person_source_value` on the `person` table `NOT NULL` for consistency in updates.
2. Make `care_site_source_value` on the `care_site` table `NOT NULL` for consistency in updates.
3. Make `provider_source_value` on the `provider` table `NOT NULL` for consistency in updates.
4. Make `care_site_id` on the `person` table `NOT NULL` for consistency in updates based on organization.
5. Make `organization_source_value` on the `organization` table `NOT NULL` for consistency in updates.
6. Make `visit_end_date` on the `visit_occurrence` table nullable to allow for visits which are ongoing at time of data extraction.

#### Data type changes

1. Increase many `VARCHAR` (or equivalent) max values to allow for more verbose data.
2. Change most primary keys (except on `organization` and `care_site`) from `INTEGER` to `BIGINT` (or equivalent) to accomodate more data.
3. Change foreign keys from `INTEGER` to `BIGINT` (or equivalent) to match the new `BIGINT` primary key data type.
4. Make primary keys auto-incrementing (except in Oracle) to emphasize that the values in those fields should not have any inherent meaning.
5. Interpret `DATE` types as strictly for storing dates without times.

## OMOP Vocabulary V4.5

The PEDSnet CDM concept IDs are taken from OMOP v4.5 vocabularies, using the complete ('restricted') version that includes licensed terminologies such as CPT and others. OMOP Vocabulary V4.5 uses the same DDL as V4. The V4 DDL has been translated into the various DDL dialects and included here for convenience. The V4.5 data in csv format is available for download [here](https://drive.google.com/uc?export=download&id=0Bzgq_ix-rkw7ZFpBR0lYcVk4WUU).

### Database Dialects

- PostgreSQL at [OMOP_Vocabulary_V4_pgsql.ddl](V1/OMOP_Vocabulary_V4_pgsql.ddl)
- MySQL at [OMOP_Vocabulary_V4_mysql.ddl](V1/OMOP_Vocabulary_V4_mysql.ddl)
- Oracle at [OMOP_Vocabulary_V4_oracle.ddl](V1/OMOP_Vocabulary_V4_oracle.ddl)
- MS SQL Server at [OMOP_Vocabulary_V4_mssql.ddl](V1/OMOP_Vocabulary_V4_mssql.ddl)

As for the PEDSnet CDM, these scripts were programmatically generated and are not yet fully tested. Please report any issues [here](https://github.com/PEDSnet/pedsnetcdms/issues).

DDL for the OMOP Vocabulary V4 table and column comments are available at [OMOP_Vocabulary_V4_comments.ddl](V1/OMOP_Vocabulary_V4_comments.ddl). The syntax should work on PostgreSQL and Oracle, but not on MySQL or MS SQL Server.

Since these files were created, the DDL generation code has moved to the [PEDSnet/pedsnetcdms](https://github.com/PEDSnet/pedsnetcdms) repository. Please look there for further work on that process.

### Changes from OMOP Vocabulary V4

The only changes made to the original OMOP Vocabulary V4 DDL were made to support automated DDL generation or because the automated generation process doesn't support some dialect specific feature. These include:

1. Addition of a primary key on the `drug_approval` table using the `ingredient_concept_id` column (SQLAlchemy table defintions require a primary key).
2. Addition of a compound primary key on the `drug_strength` table using the `drug_concept_id`, `ingredient_concept_id`, and `valid_end_date` columns (SQLAlchemy table definitions require a foreign key).
3. Interpretation of `DATE` types as strictly for storing dates without times.
4. Removal of `LOGGING` and `MONITORING` keywords from table definitions and `USING INDEX` and `LOGGING` keywords from primary key constraint definitions in the Oracle DDL.

## Original OMOP files

The original OMOP CDM and Vocabulary V4 specification and DDL files, as well as the Vocabulary V4.5 release notes, are included in [docs](V1/docs) directory for reference.
